# Replication code: Flexible climate adaptation can substantially reduce conservation costs and mitigate risks (Cho et al., 2025)

Code used to produce analyses in the paper "Flexible climate adaptation can substantially reduce conservation costs and mitigate risks" by Frankie H. T. Cho, Brooke A. Williams, Carla L. Archibald, James Brazill-Boast, Michael J. Drielsma, Daniel Lunney, Jonathan R. Rhodes

## Required data (in the directory `/data`)
One will need the data contained in the `data` directory in order to replicate the findings in the paper. Data required to produce this analysis were generated from sensitive inputs with personally identifiable information and cannot be shared without a proper licensing agreement. Please contact Jonathan Rhodes (jon.rhodes@qut.edu.au) for more information. Here we provide a description of what each file contains.
* `spatial_predictions_inf.csv`: spatial predictions of landholder willingness-to-accept conservation covenants, produced using the code in this [repository](https://github.com/koala-private-land/spatial-bid-model). Analyses were done based on code version 1.2. Note that the values here are predicted using median values from the landholder bid models. The actual values for landholder WTA were generated using the draws obtained from the Bayesian MCMC process obtained when fitting the model in the repository.
* `kitl_prop_climate.csv`: Koala in the Landscape (KITL) model outputs, containing the following columns: "NewPropID" (Property identifier), "khab_area" (Koala habitat area of the property), "climate_model" (identifier of the climate model), "t0" (KITL index at time-step 0, i.e., 2000), "t1" (KITL index at time-step 1), "t2" (KITL index at time-step 2), "t3" (KITL index at time-step 3), "t4" (KITL index at time-step 4), "t5" (KITL index at time-step 5), "t6" (KITL index at time-step 6), "t7" (KITL index at time-step 7), where t0-t7 are 10-year intervals from 2000 to 2070.
* `stratified_sample.csv`: a stratified sample generated by sub-sampling the population in `spatial_predictions_inf.csv` using `stratified_sampling.R`
* `model_matrix`: a folder that contains the model matrices and coefficients from fitting the spatial bid model. The prediction is generated by multiplying Model Matrix with the vector of coefficients.
    * `Model_MatrixX.Inf_(i).csv`: Bayesian MCMC draws of the spatial bid Bayesian regression model, representing the model matrix, and X is for the probability of adopting a covenant. The (i) represents the index number, from 1 to 10, representing 10 different survey data imputation methods used when fitting the spatial bid model. Each csv contains 1000 draws from each of the MCMC fitting iterations. Inf is for covenant paid annually for in perpetuity ("infinite").
    * `CoefsX.Inf_(i).csv`: the same as above, but contains the vector of coefficients instead.
    * `Model_MatrixY.Inf_(i).csv`: Bayesian MCMC draws of the spatial bid Bayesian regression model, with Y representing the values for the willingness-to-accept the conservation covenant. The (i) represents the index number, from 1 to 10, representing 10 different survey data imputation methods used when fitting the spatial bid model. Each csv contains 1000 draws from each of the MCMC fitting iterations. Inf is for covenant paid annually for in perpetuity ("infinite").
    * `CoefsY.Inf_(i).csv`: the same as above, but contains the vector of coefficients instead.
    * `Model_MatrixZ.Inf_(i).csv`: Bayesian MCMC draws of the spatial bid Bayesian regression model, with Z representing the values for the area listed under the covenant. The (i) represents the index number, from 1 to 10, representing 10 different survey data imputation methods used when fitting the spatial bid model. Each csv contains 1000 draws from each of the MCMC fitting iterations.
    * `CoefsZ.Inf_(i).csv`: the same as above, but contains the vector of coefficients instead.

## Code files
* `main_analysis.jl`: Julia script used to produce the main analysis, necessary for all main figures in the manuscript
* `sensitivity_analysis.jl`: Julia script used to produce the data files used in the sensitivity analyses in the supporting information.
* `sensitivity_analysis_func.jl`: functions used in the main and sensitivity analyses. It also contains the part where the data is loaded into the environment.
* `plot_mc_results.R`: the R code used to generate all main figures and tables in the manuscript
* `plot_nsw_map.R`: the R code used to plot the map of New South Wales and Australia (inset) in the supporting information
* `plot_remp.R`: the R code used to plot the Rapid Evaluation of Metapopulation Persistence (REMP) model outputs (i.e., the KITL index scores) across a range of climate scenarios
* `gurobi_init.jl`: Julia script used to initialise the path of the Gurobi optimiser in the system.
* `optim_functions.jl`: functions to set up the data as optimisation problems for Gurobi. Contains `fcn_two_stage_opt_deforestation` which is the main driver function for setting up data and solving it as optimisation problems.
* `discounting.jl`: Julia code containing the function to do discounting using UK Green Book schedules of declining discount rates, as part of the sensitivity analyses.
* `prop_zonal_stat.py`: the Python script used to do Zonal statistics for the REMP model (KITL project) outputs (in GeoTIFF) to the property level, using ArcGIS Pro with Spatial Analyst extension (as exactextractr takes too long for the number of properties), generating the inputs needed in `kitl_read_data.R`
* `kitl_read_data.R`: the script used to generate the data file `kitl_prop_climate.csv`.
* `write_shapes.R`: write shapefile information to the plots directory, for use when plotting

## Replication instructions

### Requirements
* Julia (v1.10.3)
* Microsoft VSCode (recommended)
* data directory (available upon request)
* Gurobi optimiser
* ArcGIS Pro with Spatial Analyst extension (for doing zonal statistics of REMP model outputs at the property level only)

### Instructions
1. Download Julia and install it using the Windows installer ([link](https://julialang-s3.julialang.org/bin/winnt/x64/1.10/julia-1.10.3-win64.exe))
2. Download VS Code ([link](https://code.visualstudio.com/Download))
3. Ensure that your system has a valid license for Gurobi and activate the link between Gurobi Julia package and the Gurobi installation following instructions here: [link](https://github.com/jump-dev/Gurobi.jl)
4. Open a Julia terminal, cd to the repo directory and do `] activate`
5. Create a directory `results/model_runs/` directory to collect results
6. Run `main_analysis.jl` to get the model run outputs
7. Run `sensitivity_analysis.jl` to get the sensitivity analysis outputs.
8. Use `write_shapes.R` to download and process the shapefile information and to generate the inputs used in `plot_mc_results.R`.
9. Open `plot_mc_results.R` in R/ RStudio, install required packages (using `install.packages()`) and then run the whole script. This should generate the image files that replicates the paper results.